# AgentMem 儀表板測試指南

## 🎯 快速開始測試

### 前置要求
- AgentMem 服務器正在運行（`http://localhost:8000`）
- Python 環境已配置，Streamlit 已安裝
- 至少有 5-10 條記憶存在（用於完整測試）

### 啟動應用
```bash
cd /c/Users/victor/Downloads/Claude/Side_Project/agent-memory-mvp
streamlit run ui/app.py
```

---

## 📋 測試流程

### 第 1 章：基礎連接測試

#### 1.1 首次加載
1. 打開 Streamlit 應用
2. **預期結果**:
   - 主區域顯示警告信息：「請在左側邊欄連接到服務器開始使用」
   - 側邊欄顯示 API 配置表單
   - 連接狀態顯示「未連接」

#### 1.2 連接到服務器
1. 確認 API URL 為 `http://localhost:8000`（或您的實際地址）
2. 點擊「🔗 連接服務器」按鈕
3. **預期結果**:
   - 連接狀態變為「🟢 已連接」
   - 側邊欄顯示「總記憶數」和「覆蓋率」指標
   - 主區域頁面變化
   - 出現「清除緩存」按鈕

#### 1.3 首次進入儀表板
1. 連接成功後，應自動顯示儀表板（或觀察到預設頁面）
2. **預期結果**:
   - 「📊 儀表板概覽」標題清晰可見
   - 4 個關鍵指標卡片顯示正確數據
   - 沒有錯誤消息

---

### 第 2 章：儀表板組件驗證

#### 2.1 關鍵指標行驗證
```
期望看到：
┌─────────────────────────────────────────────────┐
│ 📚 總記憶數: X  │ 🔍 可搜索數: Y  │ 📊 覆蓋率: Z%  │ ⏱️ 最後添加: Nm ago │
└─────────────────────────────────────────────────┘
```

**檢查清單**:
- [ ] 「總記憶數」數字與側邊欄一致
- [ ] 「可搜索數」 ≤ 「總記憶數」
- [ ] 「覆蓋率」是 0-100% 的百分數
- [ ] 「最後添加」顯示相對時間（"2m ago", "5h ago" 等）

#### 2.2 類型分佈圖表驗證
**檢查清單**:
- [ ] 條形圖顯示記憶類型（knowledge, note, experience, idea）
- [ ] 柱子高度反映該類型的記憶數量
- [ ] 如果某類型記憶數為 0，則不出現在圖表中
- [ ] 圖表響應流暢

#### 2.3 最近活動列表驗證
**檢查清單**:
- [ ] 顯示「最近活動」標題下最多 5 條記憶
- [ ] 每條顯示格式：`[emoji] [type]: [time_ago]`
- [ ] 例如：`📚 knowledge: 2m ago`
- [ ] 時間排序正確（最新的在最上方）

#### 2.4 最近記憶列表驗證
**檢查清單**:
- [ ] 顯示「最近記憶（最新 5 條）」標題
- [ ] 最多 5 條記憶以可展開卡片形式顯示
- [ ] 卡片顯示內容預覽（前 50 字符）
- [ ] 點擊卡片可展開顯示：
  - 完整內容
  - 類型、分類、可見性
  - 創建時間和 ID

**展開式卡片例子**:
```
1. 📚 [knowledge] 重要項目需求...
   [展開後]
   類型: knowledge | 分類: project | 可見性: private

   內容: 重要項目需求...（完整文本）

   📅 2026-02-17 14:30:45 | 🆔 abc123...
```

#### 2.5 快速操作按鈕驗證
**檢查清單**:
- [ ] 4 個按鈕清晰可見：
  - ➕ 創建記憶
  - 🔍 搜索記憶
  - 📋 管理記憶
  - 👥 共享記憶
- [ ] 點擊每個按鈕能正確導航到相應頁面
- [ ] 導航按鈕也能同樣工作（導航菜單中的 5 個按鈕）

---

### 第 3 章：緩存性能驗證

#### 3.1 首次加載性能測試
**準備**:
- 打開瀏覽器開發者工具（F12）
- 前往「Network」標籤
- 選擇「XHR」（XMLHttpRequest）過濾器

**步驟**:
1. 點擊「📊 儀表板」按鈕導航到儀表板
2. 在 Network 標籤中觀察 API 調用

**預期結果**:
- 首次加載應看到 2-3 次 API 調用：
  - `/memories/search/stats` (一次)
  - `/memories` (一次)
- 加載時間應 < 1 秒

**記錄**:
- 首次加載 API 調用次數: ___
- 首次加載總時間: ___ ms
- ✅ 符合預期（2 次調用，<1s）

#### 3.2 緩存命中測試
**步驟**:
1. 清空 Network 標籤日誌
2. 立即再次點擊「📊 儀表板」按鈕
3. 在 Network 標籤中觀察

**預期結果**:
- 30 秒內的第二次加載：
  - 看不到新的 `/memories/search/stats` 調用（命中 30s 緩存）
  - 可能看不到 `/memories` 調用（命中 60s 緩存）
- 加載時間應 < 100ms（純緩存）

**記錄**:
- 緩存命中加載 API 調用次數: ___
- 緩存命中加載總時間: ___ ms
- ✅ 符合預期（0 次調用，<100ms）

#### 3.3 緩存過期測試
**步驟**:
1. 記下當前時間
2. 等待 35 秒（超過 stats 的 30s TTL）
3. 清空 Network 標籤日誌
4. 點擊「📊 儀表板」按鈕
5. 觀察 Network 標籤

**預期結果**:
- 35 秒後應看到新的 `/memories/search/stats` 調用（stats 緩存已過期）
- 不應看到新的 `/memories` 調用（60s 緩存還未過期）

**記錄**:
- 部分緩存過期加載 API 調用次數: ___
- ✅ 符合預期（1 次調用）

#### 3.4 完全緩存過期測試
**步驟**:
1. 記下當前時間
2. 等待 65 秒（超過 memories 的 60s TTL）
3. 清空 Network 標籤日誌
4. 點擊「📊 儀表板」按鈕
5. 觀察 Network 標籤

**預期結果**:
- 65 秒後應看到 2 次 API 調用（兩個緩存都過期）

**記錄**:
- 完全過期加載 API 調用次數: ___
- ✅ 符合預期（2 次調用）

---

### 第 4 章：緩存失效驗證

#### 4.1 創建記憶後的緩存清除
**步驟**:
1. 記下儀表板中的「📚 總記憶數」
2. 點擊「➕ 創建記憶」按鈕
3. 填寫表單：
   - 記憶類型：選擇任意類型
   - 分類：輸入「test-cache」
   - 記憶內容：輸入「Test memory for cache invalidation」
4. 點擊「創建記憶」
5. 觀察成功消息中是否出現「st.balloons()」效果
6. 點擊「📊 儀表板」按鈕

**預期結果**:
- 創建成功消息中應看到氣球效果（✅ 表示緩存已清除）
- 儀表板「📚 總記憶數」應增加 1
- 新記憶應出現在「最近記憶」列表中

**記錄**:
- 創建前總數: ___
- 創建後總數: ___
- ✅ 增加了 1（緩存成功失效）

#### 4.2 更新記憶後的緩存清除
**步驟**:
1. 點擊「📋 管理記憶」
2. 前往「更新記憶」標籤
3. 輸入前面創建的記憶 ID（從成功消息中複製）
4. 找到後，修改內容為：「Updated for cache test」
5. 點擊「更新記憶」
6. 點擊「📊 儀表板」

**預期結果**:
- 更新成功後應出現成功消息
- 儀表板應立即顯示更新時間
- 最近記憶列表應看到更新的記憶

**記錄**:
- ✅ 更新成功，緩存失效正確

#### 4.3 刪除記憶後的緩存清除
**步驟**:
1. 點擊「📋 管理記憶」
2. 前往「刪除記憶」標籤
3. 輸入要刪除的記憶 ID
4. 點擊「確認刪除」
5. 觀察氣球效果
6. 點擊「📊 儀表板」

**預期結果**:
- 刪除成功應出現氣球效果（✅ 表示緩存已清除）
- 儀表板「📚 總記憶數」應減少 1
- 被刪除的記憶應從「最近記憶」列表消失

**記錄**:
- ✅ 刪除成功，緩存失效正確

#### 4.4 手動清除緩存按鈕
**步驟**:
1. 在側邊欄找到「🔄 清除緩存」按鈕
2. 點擊按鈕
3. 觀察反應

**預期結果**:
- 出現成功消息：「✓ 緩存已清除！」
- 頁面重新運行（st.rerun()）
- 儀表板重新加載所有數據

**記錄**:
- ✅ 手動清除正常工作

---

### 第 5 章：邊界情況測試

#### 5.1 空記憶狀態
**前置條件**:
- 所有記憶已刪除，或使用新的 Agent ID

**步驟**:
1. 連接到服務器
2. 導航到儀表板

**預期結果**:
- 「📚 總記憶數」: 0
- 「🔍 可搜索數」: 0
- 「📊 覆蓋率」: 0.0%
- 「⏱️ 最後添加」: N/A
- 類型分佈圖表顯示：「暫無記憶數據」
- 最近活動列表顯示：「暫無活動」
- 最近記憶列表顯示：「還沒有記憶。點擊下方『快速操作』來創建第一條記憶！」

**記錄**:
- ✅ 空狀態顯示正確

#### 5.2 大數據集性能
**前置條件**:
- 創建 100+ 條記憶

**步驟**:
1. 導航到儀表板
2. 觀察加載時間
3. 在瀏覽器 DevTools 中檢查性能

**預期結果**:
- 首次加載時間 < 1.5 秒
- 緩存命中加載 < 100ms
- 內存使用 < 100MB
- UI 仍然響應流暢

**記錄**:
- 100+ 記憶首次加載: ___ ms
- ✅ 符合預期（<1.5s）

#### 5.3 邊界日期處理
**步驟**:
1. 使用管理頁面手動編輯記憶（如果支持）
2. 或創建記憶觀察時間戳

**預期結果**:
- 時間戳正確顯示
- format_time_ago() 函數正確處理各種時間差
- 沒有 datetime 相關的錯誤

**記錄**:
- ✅ 時間處理正確

---

### 第 6 章：Bug 修復驗證

#### 6.1 Agent ID 顯示修復
**步驟**:
1. 點擊「📋 管理記憶」
2. 前往「查看記憶」標籤
3. 查看記憶卡片中的「Agent ID」指標

**預期結果**:
- Agent ID 顯示正常（格式：`xxxxxxxx...`）
- 不出現 AttributeError 錯誤
- 當 created_by_agent_id 為 None 時顯示「N/A」

**記錄**:
- ✅ Bug 修復驗證成功

---

### 第 7 章：導航驗證

#### 7.1 所有導航按鈕功能
**步驟**:
1. 在導航菜單中依次點擊每個按鈕：
   - 📊 儀表板
   - ➕ 創建記憶
   - 🔍 搜索記憶
   - 📋 管理記憶
   - 👥 共享記憶

**預期結果**:
- 每個按鈕都能正確切換到相應頁面
- 頁面標題和內容對應
- 沒有錯誤消息

**記錄**:
- ✅ 儀表板: 正常
- ✅ 創建記憶: 正常
- ✅ 搜索記憶: 正常
- ✅ 管理記憶: 正常
- ✅ 共享記憶: 正常

#### 7.2 快速操作按鈕功能
**步驟**:
1. 在儀表板中的「快速操作」部分點擊每個按鈕

**預期結果**:
- 與導航菜單功能一致
- 點擊後正確導航到相應頁面

**記錄**:
- ✅ 快速操作按鈕正常

---

## 📊 性能基準記錄

### 使用以下模板記錄測試結果

```
測試環境信息：
- 記憶總數: ___
- 記憶類型分佈: knowledge___, note___, experience___, idea___
- 網絡環境: [本地/遠程]
- 瀏覽器: [Chrome/Firefox/Edge]

性能指標：
- 首次儀表板加載: ___ ms
- 緩存命中加載: ___ ms
- 側邊欄統計加載: ___ ms
- 創建記憶 → 儀表板更新: ___ ms

快速操作時間：
- 創建記憶: ___ s
- 搜索記憶: ___ s
- 更新記憶: ___ s
- 刪除記憶: ___ s

API 調用計數：
- 首次儀表板: ___ 次
- 緩存命中儀表板: ___ 次
- 側邊欄統計: ___ 次/分鐘

系統資源：
- 內存使用: ___ MB
- CPU 使用率: ___ %
```

---

## 🐛 問題排查

### 常見問題和解決方案

#### Q: 儀表板不顯示任何數據
**A**:
- 確保服務器正在運行
- 檢查 API URL 是否正確
- 查看瀏覽器控制台是否有錯誤信息
- 嘗試點擊「🔄 清除緩存」按鈕

#### Q: API 調用次數沒有減少
**A**:
- 確認緩存函數被調用（檢查代碼中的 @st.cache_data 裝飾器）
- 在 30/60 秒內多次加載應看到 API 調用減少
- 如果仍未改進，檢查 Streamlit 版本是否支持緩存

#### Q: Agent ID 顯示為 None 或出錯
**A**:
- 這是已修復的 bug
- 確保 manage.py 已更新到最新版本
- 重啟 Streamlit 應用

#### Q: 時間顯示不正確
**A**:
- 檢查系統時間設置
- format_time_ago() 應正確處理 naive datetime
- 如果仍有問題，檢查時區設置

---

## ✅ 測試完成清單

完成所有測試後，請檢查：

- [ ] 第 1 章：基礎連接測試 ✓
- [ ] 第 2 章：儀表板組件驗證 ✓
- [ ] 第 3 章：緩存性能驗證 ✓
- [ ] 第 4 章：緩存失效驗證 ✓
- [ ] 第 5 章：邊界情況測試 ✓
- [ ] 第 6 章：Bug 修復驗證 ✓
- [ ] 第 7 章：導航驗證 ✓

**總體評分**: __ / 7 章

---

## 📝 測試結論

**日期**: _______________
**測試人員**: _______________
**環境**: _______________

**通過/未通過**: _______________

**發現的問題**:
1. ___________________________________
2. ___________________________________
3. ___________________________________

**建議改進**:
1. ___________________________________
2. ___________________________________

**簽名**: _______________
